/// üì∞ Feed de Atividades (Activity Feed)
/// Path usado no app:
/// - ActivityFeed/{feedItemId}
///   - eventId: string (refer√™ncia ao evento)
///   - userId: string (quem criou o evento)
///   - userFullName: string (congelado)
///   - activityText: string (congelado)
///   - emoji: string (congelado)
///   - locationName: string (congelado)
///   - eventDate: timestamp (congelado)
///   - createdAt: timestamp
///   - userPhotoUrl: string (opcional, congelado)
///   - status: string ('active' | 'deleted')
///
/// Quando um usu√°rio cria um evento, um item √© adicionado ao feed
/// com os dados "congelados" no momento da cria√ß√£o.

match /ActivityFeed/{feedItemId} {
  /// üìñ LEITURA:
  /// - Qualquer usu√°rio autenticado pode ler itens ativos
  /// - Autor pode ler seus pr√≥prios itens (incluindo deletados)
  allow read: if isSignedIn() && (
    resource.data.status == 'active' ||
    resource.data.userId == request.auth.uid
  );
  
  /// ‚úçÔ∏è CRIAR item no feed:
  /// - Apenas o pr√≥prio usu√°rio pode criar seu item
  /// - userId deve ser o pr√≥prio
  /// - status deve iniciar em 'active'
  allow create: if isSignedIn() &&
    request.resource.data.userId == request.auth.uid &&
    request.resource.data.status == 'active' &&
    request.resource.data.keys().hasAll(['eventId', 'userId', 'userFullName', 'activityText', 'emoji', 'locationName', 'eventDate']);
  
  /// ‚úèÔ∏è UPDATE:
  /// - Apenas o autor pode fazer soft delete (mudar status para 'deleted')
  /// - N√£o pode mudar outros campos
  allow update: if isSignedIn() &&
    resource.data.userId == request.auth.uid &&
    request.resource.data.userId == request.auth.uid &&
    request.resource.data.diff(resource.data).affectedKeys().hasOnly(['status']) &&
    request.resource.data.status == 'deleted';
  
  /// üóëÔ∏è DELETAR:
  /// - Apenas via Cloud Function (deleteEvent)
  /// - Client n√£o pode hard delete
  allow delete: if false;
}
